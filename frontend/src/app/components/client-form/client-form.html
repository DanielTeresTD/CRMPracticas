<!-- FormGroup directive binds to the FormGroup created in the .ts -->
<form [formGroup]="clientForm" (ngSubmit)="onSubmit()" class="flex flex-col gap-4">

    @for (key of fieldKeys; track key) {
    <div class="flex flex-col">
        <label class="text-sm font-semibold capitalize mb-1">{{ key }}</label>
        <!--
        Generate an input for each field in the form.  
        directive FormControlName correspond to key name in the FormGroup or FormArray, to connect with it. 
        Use readonly if field is ID or in view mode. 
        Type directive used to alternate between number or text value. 
         -->
        <input [formControlName]="key" class="border p-2 rounded" [readonly]="key === 'id' ? true : mode === 'view'"
            [type]="getFieldType(key)" />
    </div>
    }

    <!-- View mode to show phones as a list -->
    @if (clientPhones && clientPhones.length > 0 && mode === 'view') {
    <div class="flex flex-col">
        <label class="text-sm font-semibold capitalize mb-1">Teléfonos</label>
        <ul class="list-disc list-inside pl-4">
            @for (phone of clientPhones; track phone) {
            <li>{{ phone.phoneNumber }}</li>
            }
        </ul>
    </div>
    }

    <!-- Edit or add phones -->
    @if (mode !== 'view') {
    <div class="form-section">
        <label>Teléfonos:</label>
        @for (phoneGroup of phoneNums.controls; track $index; let i = $index) {
        <div class="phone-input-group">
            <!-- ✅ Campo oculto para phoneID -->
            <input type="hidden" [formControl]="getPhoneIDControl(i)">

            <!-- ✅ Input para phoneNumber -->
            <input type="text" [formControl]="getPhoneNumberControl(i)" placeholder="Número de teléfono"
                class="phone-input"
                [class.error]="getPhoneNumberControl(i).invalid && getPhoneNumberControl(i).touched">

            <button type="button" (click)="removePhone(i)" class="remove-phone-btn" [disabled]="phoneNums.length <= 1">
                Eliminar
            </button>
        </div>
        }

        <button type="button" (click)="addPhone()" class="add-phone-btn">
            Agregar teléfono
        </button>
    </div>

    <!-- Submit the form, this will trigger onSubmit() function -->
    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded mt-4">
        {{ mode === 'edit' ? 'Guardar cambios' : 'Añadir cliente' }}
    </button>
    }

</form>