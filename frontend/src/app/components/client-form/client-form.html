<!-- FormGroup directive binds to the FormGroup created in the .ts -->
<form [formGroup]="clientForm" (ngSubmit)="onSubmit()" class="flex flex-col gap-4">

    @for (key of fieldKeys; track key) {
    <div class="input-group">
        <label for="{{ key }}">{{ key | titlecase }}</label>
        <!-- Input con pInputText en input nativo -->
        <input id="{{ key }}" [formControlName]="key" [attr.readonly]="key === 'id' || mode === 'view' ? true : null"
            [type]="getFieldType(key)" pInputText placeholder="Escribe {{ key | lowercase }}" />
    </div>
    }

    <!-- Mostrar teléfonos en modo vista -->
    @if (clientPhones && clientPhones.length > 0 && mode === 'view') {
    <div class="flex flex-col input-group">
        <label>Teléfonos</label>
        <ul class="list-disc list-inside pl-4">
            @for (phone of clientPhones; track phone) {
            <li>{{ phone.phoneNumber }}</li>
            }
        </ul>
    </div>
    }

    <!-- Editar o agregar teléfonos -->
    @if (mode !== 'view') {
    <div class="form-section">
        <label style="font-weight: bold;">Teléfonos:</label>

        @for (phoneGroup of phoneNums.controls; track $index; let i = $index) {
        <div class="phone-input-group flex items-center gap-2 mb-2">
            <!-- Campo oculto para phoneID -->
            <input type="hidden" [formControl]="getPhoneIDControl(i)" />

            <!-- Input para phoneNumber -->
            <input type="text" pInputText [formControl]="getPhoneNumberControl(i)" placeholder="Número de teléfono"
                class="phone-input p-inputtext-sm"
                [class.p-invalid]="getPhoneNumberControl(i).invalid && getPhoneNumberControl(i).touched" />

            <!-- Botón eliminar teléfono -->
            <button pButton type="button" icon="pi pi-times" class="p-button-rounded p-button-danger p-button-sm"
                (click)="removePhone(i)" [disabled]="phoneNums.length <= 1" aria-label="Eliminar teléfono"></button>
        </div>
        }

        <!-- Botón agregar teléfono -->
        <button pButton type="button" icon="pi pi-plus" iconPos="left" class="p-button-agregar" (click)="addPhone()"
            aria-label="Agregar teléfono">
            Agregar teléfono
        </button>
    </div>

    <!-- Botón submit -->
    <button pButton type="submit" class="p-button-guardar">
        {{ mode === 'edit' ? 'Guardar cambios' : 'Añadir cliente' }}
    </button>
    }
</form>